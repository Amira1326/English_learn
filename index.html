<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VocabMaster Pro Max üá¨üáß</title>
<style>
:root{--primary:#6c5ce7;--secondary:#a29bfe;--success:#00b894;--danger:#ff7675;--bg:#f8f9fa;--card:#ffffff;--text:#2d3436;--shadow-light:rgba(0,0,0,0.03);--shadow-strong:rgba(0,0,0,0.08)}
.dark{--bg:#1a1a2e;--card:#16213e;--text:#e94560;--primary:#0f3460;--secondary:#1f4068;--shadow-light:rgba(0,0,0,0.2);--shadow-strong:rgba(0,0,0,0.4)}
*{box-sizing:border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);}
body{margin:0;font-family: 'Inter', system-ui, -apple-system; background:var(--bg);color:var(--text); direction: ltr;}

header{background: var(--card); padding:15px 5%; display:flex; justify-content:space-between; align-items:center; box-shadow: 0 2px 10px var(--shadow-light); position: sticky; top:0; z-index:100}
.logo { font-size: 1.5rem; font-weight: 800; background: linear-gradient(45deg, var(--primary), #fd79a8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.container{max-width:900px;margin:auto;padding:20px}

.stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:15px; margin-bottom: 30px;}
.stat-item { background: var(--card); padding: 15px; border-radius: 18px; text-align: center; box-shadow: 0 4px 6px var(--shadow-light); border-bottom: 4px solid var(--primary);}
.stat-num { display: block; font-size: 1.8rem; font-weight: bold; color: var(--primary); }
.stat-label { font-size: 0.8rem; opacity: 0.7; text-transform: uppercase; letter-spacing: 1px;}

.section-card { background: var(--card); padding: 30px; border-radius: 30px; text-align: center; margin-bottom: 40px; box-shadow: 0 20px 40px var(--shadow-light); }

.card-stack { width: 320px; height: 200px; margin: 20px auto; position: relative; cursor: pointer; perspective: 1000px; }
.card-inner { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s; }
.card-stack.flipped .card-inner { transform: rotateY(180deg); }
.card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 25px; padding: 20px; font-size: 1.5rem; font-weight: bold; box-shadow: 0 10px 20px var(--shadow-strong); }
.card-front { background: var(--primary); color: white; }
.card-back { background: var(--success); color: white; transform: rotateY(180deg); }

.quiz-options { display: grid; grid-template-columns: 1fr; gap: 12px; margin-top: 20px; }
.quiz-option { padding: 14px; border-radius: 12px; border: 2px solid var(--secondary); background: var(--bg); color: var(--text); font-size: 1.1rem; cursor: pointer; text-align: center; }
.quiz-option:hover { border-color: var(--primary); background: var(--card); }
.quiz-option.correct { background: var(--success); color: white; border-color: var(--success); animation: pulse 0.5s; }
.quiz-option.incorrect { background: var(--danger); color: white; border-color: var(--danger); animation: shake 0.5s; }

@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-5px); } 40%, 80% { transform: translateX(5px); } }

.input-grid { background: var(--card); padding: 25px; border-radius: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; box-shadow: 0 10px 20px var(--shadow-light);}
input, select { padding: 14px; border-radius: 12px; border: 2px solid #f1f2f6; background: #f8f9fa; font-size: 1rem; color: var(--text); }
.btn { padding: 12px 20px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; justify-content: center; }
.btn-primary { background: var(--primary); color: white; }
.btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }

.word-list { background: var(--card); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px var(--shadow-light); margin-bottom: 30px; }
table { width: 100%; border-collapse: collapse; }
td, th { padding: 18px; text-align: left; border-bottom: 1px solid #f1f2f6; }
th { background: #fafbff; font-size: 0.85rem; color: #a29bfe; }
.progress-mini { width: 50px; height: 6px; background: #eee; border-radius: 10px; display: inline-block; }
.progress-fill { height: 100%; background: var(--success); border-radius: 10px; }
</style>
</head>
<body>

<header>
    <div class="logo">VocabMaster üá¨üáß</div>
    <div style="display:flex; gap:10px">
        <button class="btn btn-outline" onclick="exportData()">üíæ Save</button>
        <button class="btn btn-outline" onclick="toggleTheme()">üåì Mode</button>
    </div>
</header>

<div class="container">
    <div class="stats-bar">
        <div class="stat-item"><span class="stat-num" id="stat-total">0</span><span class="stat-label">Words</span></div>
        <div class="stat-item"><span class="stat-num" id="stat-mastered">0</span><span class="stat-label">Mastered</span></div>
        <div class="stat-item"><span class="stat-num" id="stat-streak">0</span><span class="stat-label">üî• Streak</span></div>
        <div class="stat-item"><span class="stat-num" id="stat-quiz-score">0/0</span><span class="stat-label">Score</span></div>
    </div>

    <div class="section-card">
        <h3>üá¨üáß Pronunciation & Review</h3>
        <p style="opacity:0.8">Tap to hear British English (en-GB)</p>
        <div class="card-stack" id="vocabCard" onclick="flipCard()">
            <div class="card-inner">
                <div class="card-face card-front" id="q-face">Add words to start!</div>
                <div class="card-face card-back" id="a-face">The meaning shows here</div>
            </div>
        </div>
        <div style="display:flex; gap:10px; justify-content:center; margin-top:20px">
            <button class="btn btn-primary" onclick="nextCard()">‚û°Ô∏è Next</button>
            <button class="btn" style="background:var(--success); color:white" onclick="markAsMastered()">‚úÖ I Know It</button>
        </div>
    </div>

    <div class="section-card">
        <h3>üß† Word Quiz</h3>
        <div id="quizArea">
            <h4 id="quizQuestion" style="min-height: 40px;">Ready for a quiz?</h4>
            <div class="quiz-options" id="quizOptions"></div>
            <button class="btn btn-primary" id="startQuizBtn" onclick="startQuiz()">Start Quiz</button>
            <button class="btn btn-primary" id="nextQuizBtn" style="display:none;" onclick="nextQuizQuestion()">Next Question</button>
        </div>
    </div>

    <div class="input-grid">
        <div style="grid-column: 1 / -1"><h3>‚ûï Add Word</h3></div>
        <input id="wordInp" placeholder="English Word">
        <input id="meanInp" placeholder="Arabic Meaning">
        <select id="catInp"></select>
        <button class="btn btn-primary" onclick="addWord()">‚ú® Add</button>
    </div>

    <div class="word-list">
        <div style="padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--shadow-light);">
            <input id="searchInp" oninput="render()" placeholder="üîç Search..." style="width: 60%; margin:0">
            <button class="btn btn-outline" onclick="addCategoryPrompt()">+ Category</button>
        </div>
        <table id="vocabTable"></table>
    </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('vocabUltraMaxData')) || {
    words: [],
    categories: ['General', 'Travel', 'Academic'],
    streak: 0,
    lastActiveDate: null,
    quizScore: { correct: 0, total: 0 }
};

let currentReviewIndex = 0;
let currentQuizWord = null;

// --- British Speech Logic ---
function speak(text) {
    const msg = new SpeechSynthesisUtterance(text);
    // ÿ¨ŸÑÿ® ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÖÿ™ŸàŸÅÿ±ÿ© ŸÅŸä ÿßŸÑÿ¨Ÿáÿßÿ≤
    const voices = window.speechSynthesis.getVoices();
    // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿµŸàÿ™ ÿ®ÿ±Ÿäÿ∑ÿßŸÜŸä
    const britishVoice = voices.find(v => v.lang === 'en-GB' || v.lang.includes('UK'));
    
    if (britishVoice) {
        msg.voice = britishVoice;
    }
    msg.lang = 'en-GB';
    msg.rate = 0.9; // ÿ£ÿ®ÿ∑ÿ£ ŸÇŸÑŸäŸÑÿßŸã ŸÑŸäŸÉŸàŸÜ ÿßŸÑŸÜÿ∑ŸÇ ÿ£Ÿàÿ∂ÿ≠
    window.speechSynthesis.speak(msg);
}

// ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿµŸàÿßÿ™ (ÿ®ÿπÿ∂ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ÿßÿ™ ÿ™ÿ™ÿ£ÿÆÿ± ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑŸáÿß)
window.speechSynthesis.onvoiceschanged = () => {
    console.log("Speech voices loaded üá¨üáß");
};

function flipCard() {
    const card = document.getElementById('vocabCard');
    card.classList.toggle('flipped');
    if(!card.classList.contains('flipped')) {
        speak(data.words[currentReviewIndex].word);
    }
}

function nextCard() {
    if(data.words.length === 0) return;
    currentReviewIndex = (currentReviewIndex + 1) % data.words.length;
    document.getElementById('vocabCard').classList.remove('flipped');
    setTimeout(() => {
        document.getElementById('q-face').innerText = data.words[currentReviewIndex].word;
        document.getElementById('a-face').innerText = data.words[currentReviewIndex].mean;
        speak(data.words[currentReviewIndex].word);
    }, 200);
}

function markAsMastered() {
    if(data.words.length === 0) return;
    data.words[currentReviewIndex].mastery = Math.min((data.words[currentReviewIndex].mastery || 0) + 25, 100);
    playTone(1000, 0.05);
    nextCard();
    save();
}

// --- Quiz Logic ---
function startQuiz() {
    if (data.words.length < 4) return alert("Add at least 4 words first!");
    data.quizScore = { correct: 0, total: 0 };
    document.getElementById('startQuizBtn').style.display = 'none';
    document.getElementById('nextQuizBtn').style.display = 'block';
    nextQuizQuestion();
}

function nextQuizQuestion() {
    const optionsDiv = document.getElementById('quizOptions');
    optionsDiv.innerHTML = '';
    currentQuizWord = data.words[Math.floor(Math.random() * data.words.length)];
    document.getElementById('quizQuestion').innerText = `What does "${currentQuizWord.word}" mean?`;
    speak(currentQuizWord.word);

    let others = data.words.filter(w => w.id !== currentQuizWord.id).map(w => w.mean);
    let options = [currentQuizWord.mean, ...others.sort(() => 0.5 - Math.random()).slice(0, 3)];
    options.sort(() => 0.5 - Math.random());

    options.forEach(opt => {
        const div = document.createElement('div');
        div.className = 'quiz-option';
        div.innerText = opt;
        div.onclick = () => checkAnswer(div, opt);
        optionsDiv.appendChild(div);
    });
    document.getElementById('nextQuizBtn').style.display = 'none';
}

function checkAnswer(el, val) {
    document.querySelectorAll('.quiz-option').forEach(o => o.onclick = null);
    if(val === currentQuizWord.mean) {
        el.classList.add('correct');
        data.quizScore.correct++;
        currentQuizWord.mastery = Math.min((currentQuizWord.mastery || 0) + 15, 100);
        playTone(1200, 0.1);
    } else {
        el.classList.add('incorrect');
        playTone(300, 0.1);
        document.querySelectorAll('.quiz-option').forEach(o => {
            if(o.innerText === currentQuizWord.mean) o.classList.add('correct');
        });
    }
    data.quizScore.total++;
    document.getElementById('nextQuizBtn').style.display = 'block';
    save();
}

// --- General Functions ---
function addWord() {
    const w = wordInp.value.trim();
    const m = meanInp.value.trim();
    if(!w || !m) return;
    data.words.unshift({ id: Date.now(), word: w, mean: m, cat: catInp.value, mastery: 0, dateAdded: new Date().toDateString() });
    wordInp.value = ''; meanInp.value = '';
    save();
}

function save() {
    localStorage.setItem('vocabUltraMaxData', JSON.stringify(data));
    render();
}

function playTone(freq, dur) {
    const ctx = new AudioContext();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.05, ctx.currentTime);
    osc.start(); osc.stop(ctx.currentTime + dur);
}

function render() {
    document.getElementById('stat-total').innerText = data.words.length;
    document.getElementById('stat-mastered').innerText = data.words.filter(w => w.mastery >= 75).length;
    document.getElementById('stat-quiz-score').innerText = `${data.quizScore.correct}/${data.quizScore.total}`;
    
    catInp.innerHTML = data.categories.map(c => `<option>${c}</option>`).join('');
    
    const search = searchInp.value.toLowerCase();
    const filtered = data.words.filter(w => w.word.toLowerCase().includes(search));
    
    vocabTable.innerHTML = `<tr><th>Word</th><th>Category</th><th>Progress</th></tr>` + 
    filtered.map(w => `
        <tr>
            <td onclick="speak('${w.word}')" style="cursor:pointer">üîä <b>${w.word}</b><br><small>${w.mean}</small></td>
            <td><span style="font-size:0.7rem; background:#eee; padding:3px 8px; border-radius:5px">${w.cat}</span></td>
            <td><div class="progress-mini"><div class="progress-fill" style="width:${w.mastery}%"></div></div></td>
        </tr>
    `).join('');
}

function toggleTheme() { document.body.classList.toggle('dark'); }
function addCategoryPrompt() {
    const n = prompt("New Category:");
    if(n) { data.categories.push(n); save(); }
}

render();
</script>
</body>
</html>

